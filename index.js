const width = 28;
const grid = document.querySelector('.grid');
const scoreDisplay = document.getElementById('score');
let squares = [];
let pacmanPosition = 489;
let score = 0;

// 0 - pacdots
// 1 - wall
// 2 - ghost lair
// 3 - powerpellets
// 4 - empty

const layout = [
    [1,1,0,0],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,0],[0,1,0,0],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,1,0],
    [1,0,1,0],0,0,0,0,0,0,0,0,0,0,0,0,[1,0,0,0],[0,0,1,0],0,0,0,0,0,0,0,0,0,0,0,0,[1,0,1,0],
    [1,0,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,0,0,0],[0,0,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,0,1,0],
    [1,0,1,0],3,[1,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,1,0],0,[1,0,0,0],1,1,1,[0,0,1,0],0,[1,0,0,0],[0,0,1,0],0,[1,0,0,0],1,1,1,[0,0,1,0],0,[1,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,1,0],3,[1,0,1,0],
    [1,0,1,0],0,[1,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,1,1],0,[1,0,1,0],
    [1,0,1,0],0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,[1,0,1,0],
    [1,0,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,0,1,0],
    [1,0,1,0],0,[1,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,0],[0,0,0,0],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,1,1],0,[1,0,1,0],
    [1,0,1,0],0,0,0,0,0,0,0,0,0,0,0,0,[1,0,0,0],[0,0,1,0],0,0,0,0,0,0,0,0,0,0,0,0,[1,0,1,0],
    [1,0,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,1],[0,1,0,1],[0,1,1,1],0,[1,0,0,1],[0,0,1,1],0,[1,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,0],[0,1,1,0],0,[1,1,0,0],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,0,1,1],
    [0,0,0,0],1,1,1,1,[1,0,1,0],0,[1,0,0,0],[0,0,1,0],4,4,4,4,4,4,4,4,4,4,[1,0,0,0],[0,0,1,0],0,[1,0,1,0],1,1,1,1,1,
    [0,0,0,0],1,1,1,1,[1,0,1,0],0,[1,0,0,0],[0,0,1,0],4,[1,1,0,0],[0,1,0,1],[0,1,1,1],2,2,[1,1,0,1],[0,1,0,1],[0,1,1,0],4,[1,0,0,0],[0,0,1,0],0,[1,0,1,0],1,1,1,1,1,
    [1,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,1,1],4,[1,0,1,0],2,2,2,2,2,2,[1,0,1,0],4,[1,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,1,1],
    4,4,4,4,4,4,0,0,0,4,[1,0,1,0],2,2,2,2,2,2,[1,0,1,0],4,0,0,0,4,4,4,4,4,4,
    [1,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,1,0],0,[1,1,0,0],[0,1,1,0],4,[1,0,1,0],2,2,2,2,2,2,[1,0,1,0],4,[1,1,0,0],[0,1,1,0],0,[1,1,0,0],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,1,1],
    [0,0,0,0],1,1,1,1,[1,0,1,0],0,[1,0,0,0],[0,0,1,0],4,[1,0,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,1,0],4,[1,0,0,0],[0,0,1,0],0,[1,0,1,0],1,1,1,1,1,
    [1,1,0,0],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,1,1],4,[1,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,1,1],4,[1,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,1,0],
    [1,0,1,0],0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,[1,0,1,0],
    [1,0,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,1,0,0],[0,1,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,0,1,0],
    [1,0,1,0],0,[1,0,0,1],[0,0,0,1],[0,0,0,0],[0,0,1,0],0,[1,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,1,1],0,[1,0,0,0],[0,0,0,0],[0,0,0,1],[0,0,1,1],0,[1,0,1,0],
    [1,0,1,0],3,0,0,[1,0,0,0],[0,0,1,0],0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,[1,0,0,0],[0,0,1,0],0,0,3,[1,0,1,0],
    [1,0,0,0],[0,1,0,0],[0,1,1,0],0,[1,0,0,0],[0,0,1,0],0,[1,1,0,0],[0,1,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,1,0,0],[0,1,1,0],0,[1,0,0,0],[0,0,1,0],0,[1,1,0,0],[0,1,0,0],[0,0,1,0],
    [1,0,0,0],[0,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,1,1],0,[1,0,0,0],[0,0,1,0],0,[1,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,0],[0,0,0,0],[0,0,0,1],[0,0,0,1],[0,0,1,1],0,[1,0,0,0],[0,0,1,0],0,[1,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,0,1],[0,0,1,0],
    [1,0,1,0],0,0,0,0,0,0,[1,0,0,0],[0,0,1,0],0,0,0,0,[1,0,0,0],[0,0,1,0],0,0,0,0,[1,0,0,0],[0,0,1,0],0,0,0,0,0,0,[1,0,1,0],
    [1,0,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,0,0,0],[0,0,1,0],0,[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0],0,[1,0,1,0],
    [1,0,1,0],0,[1,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,1,1],0,[1,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,0,1],[0,0,1,1],0,[1,0,1,0],
    [1,0,1,0],0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,[1,0,1,0],
    [1,0,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,0,1,1]
]

//create board
function createBoard() {
    //for loop 
    for (let i = 0; i < layout.length; i++) {
        //create a square 
        const square = document.createElement('div')
        //put square in grid 
        grid.appendChild(square)
        //put square in sqaures array
        squares.push(square)

        if(Array.isArray(layout[i])){
            squares[i].classList.add('wall')
            if(layout[i][0] === 1) {
                squares[i].classList.add('wall-left')
            }
            if(layout[i][1] === 1) {
                squares[i].classList.add('wall-top')
            }
            if(layout[i][2] === 1) {
                squares[i].classList.add('wall-right')
            }
            if(layout[i][3] === 1) {
                squares[i].classList.add('wall-bottom')
            }
                    
        }

        if (layout[i] === 0) {
            squares[i].classList.add('pac-dot')
        } else if (layout[i] === 3) {
            squares[i].classList.add('power-pellet')
        }
        
    }
}

createPacman = () => {
    squares[pacmanPosition].classList.add('pacman')
}

//37 = left 38 up 39 right 40 down
// row length is 28

checkForWall = (newPosition) => {
    return squares[newPosition].classList.contains("wall")    
}

movePacman = (e) => {
    const pacman = document.getElementsByClassName('pacman')
    let newPosition = pacmanPosition
    let direction = ""
    squares[pacmanPosition].classList.remove('pacman')

    squares[pacmanPosition].classList.remove('left')
    squares[pacmanPosition].classList.remove('up')
    squares[pacmanPosition].classList.remove('right')
    squares[pacmanPosition].classList.remove('down')

    if(e.keyCode === 37){
        newPosition -= 1
        direction = "left"
    }
    else if(e.keyCode === 38){
        newPosition -= width
        direction = "up"
    }
    else if(e.keyCode === 39){
        newPosition += 1
        direction = "right"
    }
    else if(e.keyCode === 40){
        newPosition += width
        direction = "down"
    }
    else {
        alert(`That's not a valid key. Press arrow only to move pacman`);
    }

    if (pacmanPosition === 364 && e.keyCode === 37){
        pacmanPosition = 364 + width - 1
    }
    else if (pacmanPosition === 391 && e.keyCode === 39){
        pacmanPosition = 391 - width + 1
    }
    else if(!checkForWall(newPosition)) {
        pacmanPosition = newPosition
    }
        
    if(squares[pacmanPosition].classList.contains("pac-dot")){
        squares[pacmanPosition].classList.remove('pac-dot')
        score ++
        scoreDisplay.textContent = score
    }
    
    squares[pacmanPosition].classList.add('pacman')
    squares[pacmanPosition].classList.add(direction)
}

document.addEventListener("keydown", movePacman)

createBoard();
createPacman();
